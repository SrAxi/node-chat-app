<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Node Chat App</title>
	<script src="https://cdn.jsdelivr.net/npm/vue"></script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css"
	      integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
</head>
<body>

<main id="app">
	<div class="container">
		<div class="row">
			<div class="col-lg-12 text-center">
				<h1>My chat</h1>
			</div>
		</div>
		<div class="row">
			<div class="col-md-6 col-md-offset-3">
				<div class="panel panel-login">
					<div class="panel-heading">
						<div class="row">
							<div class="col-xs-6">
								<p v-for="message in messages"><strong>[{{ message.from }}]:</strong> {{ message.text }}
								</p>
							</div>
						</div>
						<hr>
					</div>
					<div class="panel-body">
						<div class="row">
							<div class="col-lg-12">
								<form id="send-message-form">
									<div class="input-group mb-3">
										<input id="message-input" type="text" class="form-control"
										       placeholder="Type your message..."
										       aria-label="Type your message..."
										       @input="inputChanged" v-model="currentMessage">
										<div class="input-group-append">
											<button class="btn btn-success" type="button" @click="sendMessage">Send
											</button>
										</div>
									</div>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</main>

<script src="/socket.io/socket.io.js"></script>
<script>
    const socket = io();

    socket.on('connect', () => {
        console.log('Connected to server');
    });

    socket.on('disconnect', () => {
        console.log('Disconnected from server');
    });

    socket.on('newMessage', (message) => {
        console.log('newMessage', message);
        app.messages.push(message);
    });

    let app = new Vue({
        el: '#app',
        data: {
            messages: [],
            currentMessage: ''
        },
        methods: {
            sendMessage() {
                socket.emit('createMessage', {
                    from: 'SrAxi',
                    text: this.currentMessage
                }, (data) => {
                    console.log('Message sent', data);
                    this.currentMessage = '';
                });
            },
            inputChanged({ target }) {
                this.currentMessage = target.value;
            }
        }
    });
</script>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
        integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
        crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"
        integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm"
        crossorigin="anonymous"></script>
</body>
</html>